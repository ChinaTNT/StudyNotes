<html>
<head>
  <title>SQL学习指南</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/307941 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1391"/>
<h1>SQL学习指南</h1>

<div>
<span><div><span style="font-size: 14pt; font-weight: bold;">SQL Server</span></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">什么是数据库</span></div><div>    可以对数据进行存储和管理的软件以及数据本身 统称为数据库。</div><div><br/></div><div>数据库由表、关系、操作组</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">为什么需要数据库</span></div><div>     几乎所有的应用软件的后台都需要数据库</div><div>     数据库存储数据占用空间小容易持久保存</div><div>     存储比较安全</div><div>     容易维护和升级 </div><div>     数据库移植比较容易</div><div>     简化对数据的操作</div><div>     B/S架构里面包含数据库 </div><div>     <img src="SQL学习指南_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">数据结构和数据库区别</span></div><div>        数据库是在应用软件级别研究数据的存储和操作</div><div>        数据结构是在系统软件级别研究数据的存储和操作</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">附加和分离数据库</span></div><div>        附加：添加数据库</div><div>        分离：分离出数据库以便移植，分离前需断开连接</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">约束 </span></div><div>        定义：对一个表中属性操作的限制</div><div>        分类：主键约束 -- 不允许重复元素，避免数据的冗余</div><div>                  外键约束 -- 通过外键约束从语法上保证了本事物所关联的其他事物一定是存在的</div><div>                  check约束 -- 保证事物属性的取值在合法范围之内</div><div>                  default约束 -- 保证事物属性一定会有一个值</div><div>                  唯一约束 -- 保证了事物属性的取值不允许重复，但允许其中有一列为null且只能有一个null</div><div>                  问题：unique键是否允许多列为空？</div><div>                  KEY：SqlServer2005只允许一个unique列为空</div><div>                            Oracle11G允许多个unique列为空</div><div><br/></div><div>not null 要求用户必须为该属性赋值，否则语法出错。默认允许null。</div><div><br/></div><div>数据库是通过表来解决事物的存储问题的</div><div>数据库是通过约束来解决事物取值的有效性和合法性问题</div><div>建表的过程就是指定事物属性及其事物属性各种约束的过程</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">关系</span></div><div>        表与表之间的联系</div><div>        实现方式：通过设置不同形式的外键来体现表和表的不同关系</div><div>        分类</div><div>                一对一</div><div>                        既可以把表A的主键充当表B的外键</div><div>                        也可以把表B的主键充当表A的外键</div><div>                一对多</div><div>                        把表A的主键充当表B的外键</div><div>                        或者讲：把A表的主键添加到B表来充当B表的外键</div><div>                        在多的一方添加外键</div><div>                多对多</div><div>                         多对多必须得通过单独的一张表来表示</div><div>                         例如 id 班级和id 老师，然后根据它们的关系构成一张新表：id 班级（外键） 老师（外键） 其他附加项</div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">主键</span></div><div>        能够唯一标示一个事物的一个字段或者多个字段的组合，被称为主键</div><div>        特点：</div><div>                含主键的表叫做主键表</div><div>                主键通常都是整数，不建议使用字符串当主键（如果主键用于集群式服务，才可以考虑用字符串当主键）</div><div>                主键的值通常不允许修改，除非本记录被删除。</div><div>                主键不要定义成id，而要定义成表名id或者表名_id</div><div>                要用代理主键，不要用业务主键</div><div>                        任何一张表，强烈建议不要使用有业务含义的字段充当主键</div><div>                        我们通常都在表中单独添加一个整型的编号充当主键字段（代理主键）</div><div>                主键是否连续增长不是十分重要</div><div><span style="font-size: 12pt; font-weight: bold;">唯一键</span></div><div>        业务含义的值例如邮箱不能当主键，是因为业务值可能被修改，易出风险也不易维护。但又要求唯一，这时候就可以把它定义为唯一键。--代理主键。</div><div> </div><div><span style="font-size: 12pt; font-weight: bold;">外键</span></div><div>        定义：如果一个表中的若干字段是来自另外若干表的<span style="font-weight: bold;">主键或唯一键</span>，则这若干字段就是外键</div><div>        注：</div><div>                外键通常是来自另外表的主键而不是唯一键，因为唯一键可能为null</div><div>                外键不一定是来自另外的表，也可能来自本表的主键</div><div>                含有外键的表叫外键表，外键字段来自的那一张表叫主键表</div><div>        问题：先删主键表还是外键表？</div><div>        KEY:先删外键表。先删主键表会报错，这样会导致外键表中的数据引用失败。   </div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">查询</span></div><div>        计算列</div><div><br/></div><div>            </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>select * from emp；--从emp表中查询所有列信息，当数据量巨大时勿使用</div><div>select ename, sal from emp;</div><div>select ename, sal*12 as &quot;年薪&quot;, job from emp; </div><div>--在oracle中字段的别名不允许用单引号括起来。但SQLServer可以，为了兼用性，</div><div>--字段最好用双引号括起来，不要用单引号。</div></div><div><br/></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt; font-weight: bold;">distinct 【不允许重复的】</span></div><div><img src="SQL学习指南_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">between 【在某个范围】</span></div><div><span style="font-weight: bold;">    <img src="SQL学习指南_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div>                    <img src="SQL学习指南_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">in 【属于若干个孤立的值】</span></div><div><span style="font-weight: bold;">     <img src="SQL学习指南_files/Image [4].png" type="image/png" data-filename="Image.png"/></span></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt; font-weight: bold;">top 【最前面若干条记录 专属于SQL Server语法 无法移植其他数据库】</span></div><div>         若15%*记录数不是整数，往正方向取整，如2.1为3。</div><div><span style="font-weight: bold;">       <img src="SQL学习指南_files/Image [5].png" type="image/png" data-filename="Image.png"/></span></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">分页查询</span></div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold;">   </span> 假设每页显示n条记录，当前要显示的是第m页</div><div>        表名是A 主键是A_id</div><div>        分页查询语句</div><div>        </div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>SELECT TOP n *</div><div>FROM A </div><div>WHERE A_id not in (SELECT TOP n*(m-1) A_id FROM A)</div></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">NULL 【没有值 空值】</span></div><div><span style="font-weight: bold;">      <img src="SQL学习指南_files/Image [6].png" type="image/png" data-filename="Image.png"/></span></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">order by 【以某个字段排序】</span></div><div>       <img src="SQL学习指南_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt; font-weight: bold;">模糊查询 【搜索中常使用】</span></div><div><span style="font-weight: bold;"><img src="SQL学习指南_files/Image [8].png" type="image/png" data-filename="Image.png"/></span></div><div><br/></div><div><img src="SQL学习指南_files/Image [9].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">聚合函数 【多行记录返回一个值 通常用于统计分组的信息】</span></font></div><div>        <img src="SQL学习指南_files/Image [10].png" type="image/png" data-filename="Image.png"/></div><div>                        <img src="SQL学习指南_files/Image [11].png" type="image/png" data-filename="Image.png"/></div><div>            <img src="SQL学习指南_files/Image [12].png" type="image/png" data-filename="Image.png"/></div><div><font style="font-size: 12pt;"><br/></font></div><div><span style="font-size: 12pt; font-weight: bold;">group by 【分组】</span></div><div>                <img src="SQL学习指南_files/Image [13].png" type="image/png" data-filename="Image.png"/></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">having 【对分组之后的信息进行过滤】</span></font></div><div>            1 having子句是用来对分组之后的数据进行过滤，因此使用having先使用group by</div><div>            2 没有使用group by但使用having 则意味着having把所有记录当做一组来进行过滤</div><div>                    <img src="SQL学习指南_files/Image [14].png" type="image/png" data-filename="Image.png"/></div><div>            3 having子句出现的字段必须是分组之后的组的整体信息，不允许出现组内的详细信息</div><div>            4 having子句中不能出现字段的别名，只能使用字段最原始的名字</div><div>            5 having和where的异同</div><div>               <img src="SQL学习指南_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">连接查询</span></div><div>    定义</div><div>        将两个表或者两个以上的表以一定的连接条件连接起来，从中检索满足条件的数据</div><div>    分类</div><div>        内连接</div><div>                <img src="SQL学习指南_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>            <img src="SQL学习指南_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div>               <img src="SQL学习指南_files/Image [18].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><img src="SQL学习指南_files/Image [19].png" type="image/png" data-filename="Image.png"/></div><div>                        <img src="SQL学习指南_files/Image [20].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;"><br/></span></div><div><span style="font-size: 12pt; font-weight: bold;">内联接（inner join）</span></div><div><font style="font-size: 10pt;"><span>    </span><span>    </span>返回所有相匹配的行对。废弃两个表中不匹配的行。</font></div><div><img src="SQL学习指南_files/Image [21].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [22].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [23].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [24].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">外联接（out join left/right）</span></div><div><br/></div><div><img src="SQL学习指南_files/Image [25].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [26].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [27].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;"><br/></span></div><div><span style="font-size: 12pt;"><b><img src="SQL学习指南_files/Image [28].png" type="image/png" data-filename="Image.png"/></b></span><span style="font-size: 12pt; font-weight: bold;">完全</span><span style="font-size: 12pt; font-weight: bold;">联</span><span style="font-size: 12pt; font-weight: bold;">接（full join）</span></div><div><img src="SQL学习指南_files/Image [29].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><img src="SQL学习指南_files/Image [30].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-size: 12pt; font-weight: bold;">交叉</span><span style="font-size: 12pt; font-weight: bold;">联</span><span style="font-size: 12pt; font-weight: bold;">接 （cross join）</span></div><div><img src="SQL学习指南_files/Image [31].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">自连接</span></div><div><img src="SQL学习指南_files/Image [32].png" type="image/png" data-filename="Image.png"/></div><div><span style="font-size: 12pt; font-weight: bold;">联合</span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [33].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [34].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [35].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [36].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [37].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><img src="SQL学习指南_files/Image [38].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 12pt;"><b><img src="SQL学习指南_files/Image [39].png" type="image/png" data-filename="Image.png"/></b></span></div><div><span style="font-size: 16px;"><span style="font-size: 16px; font-weight: bold;"><br/></span></span></div><div><span style="font-size: 16px;"><span style="font-size: 16px; font-weight: bold;">identity</span></span></div><div><img src="SQL学习指南_files/Image [40].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [41].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><img src="SQL学习指南_files/Image [42].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [43].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [44].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [45].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [46].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [47].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><font style="font-size: 12pt;"><b>事务</b></font></div><div><img src="SQL学习指南_files/Image [48].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [49].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [50].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [51].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [52].png" type="image/png" data-filename="Image.png"/></div><div><img src="SQL学习指南_files/Image [53].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>create database Test</div><div><br/></div><div>use Test</div><div>create table bank</div><div>(</div><div>    customerEname nvarchar(200),</div><div>    currentMoney money</div><div>)</div><div>insert into bank values ('张三', 1000)</div><div>insert into bank values ('李四', 1)</div><div><br/></div><div>alter table bank add constraint check_currentMoney check(currentMoney&gt;=1)</div><div><br/></div><div>update bank set currentMoney=currentMoney-1000 where customerEname='张三'</div><div>update bank set currentMoney=currentMoney+1000 where customerEname='李四'</div><div><br/></div><div>begin transaction</div><div>declare @errorSum int</div><div>set @errorSum = 0</div><div>update bank set currentMoney=currentMoney-1000</div><div>    where customerEname='张三'</div><div>set @errorSum = @errorSum + @@error</div><div>update bank set currentMoney=currentMoney+1000</div><div>    where customerEname='李四'</div><div>set @errorSum = @errorSum + @@error</div><div>if (@errorSum &lt;&gt; 0)</div><div>    begin</div><div>        print '转账失败'</div><div>        rollback transaction</div><div>    end</div><div>else</div><div>    begin</div><div>        print '转账成功'</div><div>        commit transaction</div><div>    end</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 